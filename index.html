<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAT Treasury Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0d0d12; --bg-secondary: #13131a; --bg-tertiary: #1a1a24; --bg-card: #16161f;
            --border: #252530; --border-light: #2a2a38;
            --text-primary: #f5f5f7; --text-secondary: #9898a6; --text-muted: #5a5a6e;
            --btc: #f7931a; --eth: #627eea; --sol: #9945ff; --hype: #00d395; --bnb: #f0b90b;
            --green: #22c55e; --red: #ef4444; --blue: #3b82f6; --orange: #f97316;
            --accent: #a78bfa; --accent-dark: #7c3aed;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* === HEADER === */
        .header { 
            background: var(--bg-secondary); 
            border-bottom: 1px solid var(--border); 
            padding: 0 24px; 
            height: 56px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            position: sticky; 
            top: 0; 
            z-index: 100;
        }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .logo { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .logo-icon { 
            width: 32px; height: 32px; 
            background: linear-gradient(135deg, var(--accent-dark), var(--accent)); 
            border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 10px; font-weight: 700; color: white;
        }
        .logo-text { font-size: 15px; font-weight: 600; color: var(--text-primary); }
        .logo-divider { width: 1px; height: 24px; background: var(--border); }
        .powered-by { font-size: 11px; color: var(--text-muted); }
        .powered-by a { color: var(--accent); text-decoration: none; }
        .powered-by a:hover { text-decoration: underline; }

        .header-right { display: flex; align-items: center; gap: 12px; }
        .last-updated { font-size: 11px; color: var(--text-muted); }
        .status-badge { 
            display: flex; align-items: center; gap: 6px; 
            padding: 6px 10px; 
            background: rgba(34, 197, 94, 0.1); 
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 6px; 
            font-size: 11px; 
            color: var(--green);
        }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        
        .btn-refresh { 
            display: flex; align-items: center; gap: 6px;
            padding: 8px 14px; 
            background: var(--accent-dark); 
            border: none; 
            border-radius: 6px; 
            color: white; 
            font-size: 12px; 
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-refresh:hover { background: #6d28d9; }

        /* === MAIN CONTENT === */
        .main { padding: 20px 24px; max-width: 1800px; margin: 0 auto; }

        /* === STATS ROW === */
        .stats-row { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 20px; 
            overflow-x: auto;
            padding-bottom: 4px;
        }
        .stat-card { 
            flex: 1; 
            min-width: 160px;
            background: var(--bg-card); 
            border: 1px solid var(--border); 
            border-radius: 10px; 
            padding: 14px 16px;
        }
        .stat-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
        .stat-value { font-size: 18px; font-weight: 600; }
        .stat-meta { font-size: 10px; color: var(--text-muted); margin-top: 4px; }
        .stat-card.btc .stat-value { color: var(--btc); }
        .stat-card.eth .stat-value { color: var(--eth); }
        .stat-card.sol .stat-value { color: var(--sol); }
        .stat-card.hype .stat-value { color: var(--hype); }
        .stat-card.bnb .stat-value { color: var(--bnb); }

        /* === FILTER TABS === */
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; padding: 0 4px; }
        .tabs { display: flex; gap: 4px; background: var(--bg-secondary); padding: 4px; border-radius: 8px; border: 1px solid var(--border); }
        .tab { 
            padding: 7px 14px; 
            border: none; 
            border-radius: 6px; 
            background: transparent; 
            color: var(--text-muted); 
            font-size: 12px; 
            font-weight: 500;
            cursor: pointer; 
            transition: all 0.15s;
            font-family: inherit;
        }
        .tab:hover { color: var(--text-secondary); }
        .tab.active { background: var(--accent-dark); color: white; }
        
        .toolbar-right { display: flex; align-items: center; gap: 8px; }
        .company-count { font-size: 12px; color: var(--text-muted); }

        /* === TABLE === */
        .table-container { 
            background: var(--bg-secondary); 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            overflow: hidden;
        }
        .table-scroll { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { 
            padding: 12px 16px; 
            text-align: left; 
            font-size: 10px; 
            font-weight: 600; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            background: var(--bg-tertiary); 
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }
        td { padding: 14px 16px; border-bottom: 1px solid var(--border); }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: rgba(255,255,255,0.02); }
        .right { text-align: right; }
        .center { text-align: center; }

        /* === TABLE CELLS === */
        .company-cell { display: flex; align-items: center; gap: 12px; }
        .ticker-badge { 
            display: inline-flex; align-items: center; justify-content: center;
            min-width: 52px; 
            padding: 5px 8px; 
            border-radius: 6px; 
            font-size: 11px; 
            font-weight: 600;
        }
        .ticker-badge.btc { background: rgba(247,147,26,0.12); color: var(--btc); }
        .ticker-badge.eth { background: rgba(98,126,234,0.12); color: var(--eth); }
        .ticker-badge.sol { background: rgba(153,69,255,0.12); color: var(--sol); }
        .ticker-badge.hype { background: rgba(0,211,149,0.12); color: var(--hype); }
        .ticker-badge.bnb { background: rgba(240,185,11,0.12); color: var(--bnb); }
        
        .company-info { }
        .company-name { font-weight: 500; font-size: 13px; }
        .company-note { font-size: 10px; color: var(--text-muted); margin-top: 2px; max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .holdings { font-weight: 600; font-size: 14px; }
        .token-label { font-size: 11px; color: var(--text-muted); margin-left: 4px; }
        
        .change-positive { color: var(--green); font-size: 12px; }
        .change-negative { color: var(--red); font-size: 12px; }
        .no-change { color: var(--text-muted); font-size: 11px; }

        .date-cell { font-size: 12px; color: var(--text-secondary); }
        .date-cell.fresh { color: var(--green); }

        .alert-badge { 
            display: inline-flex; align-items: center; gap: 4px;
            padding: 4px 8px; 
            background: rgba(249,115,22,0.12); 
            border: 1px solid rgba(249,115,22,0.25);
            border-radius: 4px; 
            font-size: 10px; 
            font-weight: 600; 
            color: var(--orange);
            text-decoration: none;
            animation: blink 1.8s infinite;
        }
        .alert-badge:hover { background: rgba(249,115,22,0.2); }

        .link-cell a { 
            color: var(--accent); 
            text-decoration: none; 
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.15s;
        }
        .link-cell a:hover { background: rgba(167,139,250,0.1); }
        .link-cell .na { color: var(--text-muted); font-size: 10px; }

        /* === FOOTER === */
        .footer { 
            margin-top: 32px; 
            padding: 16px 24px; 
            border-top: 1px solid var(--border); 
            text-align: center; 
            font-size: 11px; 
            color: var(--text-muted);
        }
        .footer a { color: var(--accent); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }

        /* === FILING FEED === */
        .filing-feed {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .filing-feed-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }
        .filing-feed-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        .filing-feed-subtitle {
            font-size: 11px;
            color: var(--text-muted);
        }
        .filing-feed-filter {
            margin-left: auto;
        }
        .filing-feed-filter select {
            padding: 6px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
        }
        .filing-feed-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .filing-feed-empty {
            padding: 24px;
            text-align: center;
            color: var(--text-muted);
            font-size: 12px;
        }
        .filing-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }
        .filing-item:last-child {
            border-bottom: none;
        }
        .filing-item:hover {
            background: rgba(255,255,255,0.02);
        }
        .filing-item.is-new {
            background: rgba(249,115,22,0.05);
        }
        .filing-item-left {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 180px;
        }
        .filing-new-badge {
            padding: 2px 6px;
            background: var(--orange);
            border-radius: 3px;
            font-size: 9px;
            font-weight: 700;
            color: white;
            animation: blink 1.8s infinite;
        }
        .filing-ticker {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        .filing-ticker.btc { background: rgba(247,147,26,0.12); color: var(--btc); }
        .filing-ticker.eth { background: rgba(98,126,234,0.12); color: var(--eth); }
        .filing-ticker.sol { background: rgba(153,69,255,0.12); color: var(--sol); }
        .filing-ticker.hype { background: rgba(0,211,149,0.12); color: var(--hype); }
        .filing-ticker.bnb { background: rgba(240,185,11,0.12); color: var(--bnb); }
        .filing-type {
            font-size: 10px;
            color: var(--text-muted);
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
        }
        .filing-date {
            font-size: 11px;
            color: var(--text-muted);
        }
        .filing-item-center {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filing-summary {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 400px;
        }
        .filing-change {
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .filing-change.positive {
            background: rgba(34,197,94,0.12);
            color: var(--green);
        }
        .filing-change.negative {
            background: rgba(239,68,68,0.12);
            color: var(--red);
        }
        .filing-item-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filing-link {
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--accent);
            font-size: 11px;
            text-decoration: none;
            transition: background 0.15s;
        }
        .filing-link:hover {
            background: rgba(167,139,250,0.1);
        }
        .filing-ai-btn {
            padding: 4px 8px;
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.15s;
        }
        .filing-ai-btn:hover {
            opacity: 0.9;
        }
        .filing-ai-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* === AI SUMMARY POPUP === */
        .ai-summary-popup {
            position: fixed;
            z-index: 1000;
            width: 320px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .ai-summary-popup-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            border-radius: 10px 10px 0 0;
        }
        .ai-summary-popup-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .ai-summary-popup-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        .ai-summary-popup-close:hover {
            color: var(--text-primary);
        }
        .ai-summary-popup-content {
            padding: 14px;
            font-size: 12px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        /* === SECTOR PULSE === */
        .sector-pulse {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .sector-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 16px;
        }
        .sector-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .sector-token {
            font-size: 12px;
            font-weight: 600;
        }
        .sector-token.btc { color: var(--btc); }
        .sector-token.eth { color: var(--eth); }
        .sector-token.sol { color: var(--sol); }
        .sector-token.hype { color: var(--hype); }
        .sector-token.bnb { color: var(--bnb); }
        .sector-count {
            font-size: 11px;
            color: var(--text-muted);
        }
        .sector-activity {
            font-size: 11px;
            color: var(--text-secondary);
        }
        .sector-activity.has-change {
            color: var(--green);
        }

        /* === V2 DASHBOARD LAYOUT === */
        .dashboard-hero {
            margin-bottom: 24px;
        }
        .dashboard-hero .filing-feed {
            border-radius: 16px;
            border-width: 2px;
        }
        .dashboard-hero .filing-feed-header {
            padding: 18px 20px;
        }
        .dashboard-hero .filing-feed-title {
            font-size: 16px;
        }
        .dashboard-hero .filing-feed-list {
            max-height: 400px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        @media (max-width: 900px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .recent-activity-panel,
        .sector-summary-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        .panel-header {
            display: flex;
            align-items: baseline;
            gap: 12px;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }
        .panel-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        .panel-subtitle {
            font-size: 11px;
            color: var(--text-muted);
        }

        .recent-activity-list {
            max-height: 280px;
            overflow-y: auto;
        }
        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }
        .activity-item:last-child {
            border-bottom: none;
        }
        .activity-item:hover {
            background: rgba(255,255,255,0.02);
        }
        .activity-ticker {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            min-width: 50px;
            text-align: center;
        }
        .activity-ticker.btc { background: rgba(247,147,26,0.12); color: var(--btc); }
        .activity-ticker.eth { background: rgba(98,126,234,0.12); color: var(--eth); }
        .activity-ticker.sol { background: rgba(153,69,255,0.12); color: var(--sol); }
        .activity-ticker.hype { background: rgba(0,211,149,0.12); color: var(--hype); }
        .activity-ticker.bnb { background: rgba(240,185,11,0.12); color: var(--bnb); }
        .activity-info {
            flex: 1;
        }
        .activity-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }
        .activity-date {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 2px;
        }
        .activity-change {
            font-size: 13px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        .activity-change.positive {
            color: var(--green);
        }
        .activity-change.negative {
            color: var(--red);
        }
        .activity-empty {
            padding: 32px 16px;
            text-align: center;
            color: var(--text-muted);
            font-size: 12px;
        }

        .sector-summary-panel .sector-pulse {
            margin: 0;
            padding: 12px;
            gap: 10px;
            display: flex;
            flex-direction: column;
        }
        .sector-summary-panel .sector-card {
            background: var(--bg-tertiary);
            padding: 12px 14px;
            border-radius: 8px;
        }

        /* Stats details (collapsible) */
        .stats-details {
            margin-bottom: 24px;
        }
        .stats-summary {
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .stats-summary:hover {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }
        .stats-details[open] .stats-summary {
            border-radius: 8px 8px 0 0;
            border-bottom: none;
        }
        .stats-details .stats-row {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 12px;
            margin-bottom: 0;
        }

        /* Holdings section */
        .holdings-section {
            margin-bottom: 24px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            margin-right: 16px;
        }
        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <a href="#" class="logo">
                <div class="logo-icon">DAT</div>
                <span class="logo-text">Treasury Monitor</span>
            </a>
            <div class="logo-divider"></div>
            <div class="powered-by">Powered by <a href="https://www.artemisanalytics.com" target="_blank">Artemis</a></div>
        </div>
        <div class="header-right">
            <span class="last-updated" id="lastUpdated">Updated: â€”</span>
            <div class="status-badge">
                <div class="status-dot"></div>
                <span>Live</span>
            </div>
            <button class="btn-refresh" onclick="location.reload()">
                <span>â†»</span> Refresh
            </button>
        </div>
    </header>

    <main class="main">
        <!-- V2 Hero Section: Filing Feed -->
        <section class="dashboard-hero">
            <div id="filingFeed"></div>
        </section>

        <!-- V2 Two-Column Layout: Recent Activity + Sector Summary -->
        <section class="dashboard-grid">
            <div class="recent-activity-panel">
                <div class="panel-header">
                    <h3 class="panel-title">Recent Activity</h3>
                    <span class="panel-subtitle">Token purchases this week</span>
                </div>
                <div class="recent-activity-list" id="recentActivity"></div>
            </div>
            <div class="sector-summary-panel">
                <div class="panel-header">
                    <h3 class="panel-title">Sector Summary</h3>
                    <span class="panel-subtitle">DAT holdings by token</span>
                </div>
                <div class="sector-pulse" id="sectorPulse"></div>
            </div>
        </section>

        <!-- Collapsible Stats (de-emphasized) -->
        <details class="stats-details">
            <summary class="stats-summary">View Token Totals</summary>
            <div class="stats-row" id="statsRow"></div>
        </details>

        <!-- Holdings Table -->
        <section class="holdings-section">
            <div class="toolbar">
                <div class="toolbar-left">
                    <h3 class="section-title">Holdings Overview</h3>
                    <div class="tabs" id="tabs"></div>
                </div>
                <div class="toolbar-right">
                    <span class="company-count" id="companyCount">21 companies</span>
                </div>
            </div>

            <div class="table-container">
                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>Company</th>
                                <th class="right">Holdings</th>
                                <th class="right">Change</th>
                                <th class="center">Updated</th>
                                <th class="center">Alert</th>
                                <th class="center">SEC</th>
                                <th class="center">IR</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        DAT Treasury Monitor â€¢ <a href="https://www.artemisanalytics.com" target="_blank">Artemis</a> â€¢ Tracking Digital Asset Treasury Companies
    </footer>

    <script>
        // Fallback embedded data (used if data.json fetch fails)
        const FALLBACK_DATA = {
            "lastUpdatedDisplay": "Jan 21, 2026 02:33 PM ET",
            "companies": {
                "BTC": [
                    {"ticker": "MSTR","name": "Strategy","notes": "Rebranded from MicroStrategy Feb 2025","tokens": 709715,"lastUpdate": "2026-01-20","change": 22305,"cik": "0001050446","irUrl": "https://www.strategy.com/investor-relations","alertUrl": "https://www.sec.gov/Archives/edgar/data/1050446/000119312526016002/mstr-20260105.htm","alertDate": "2026-01-20","alertNote": "8-K: 8-K"},
                    {"ticker": "XXI","name": "Twenty One Capital","notes": "Backed by Tether, SoftBank, Cantor","tokens": 43514,"lastUpdate": "2025-12-09","change": 0,"cik": "0002070457","irUrl": "https://xxi.money/","alertUrl": "https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK=0002070457&type=S-1","alertDate": "2026-01-05","alertNote": "S-1 filing"},
                    {"ticker": "MTPLF","name": "Metaplanet","notes": "Japan TSE - No SEC","tokens": 35102,"lastUpdate": "2025-12-30","change": 4279,"irUrl": "https://metaplanet.jp/en/shareholders/disclosures"},
                    {"ticker": "ASST","name": "Strive","tokens": 7627,"lastUpdate": "2026-01-05","change": 0,"cik": "0001855631","irUrl": "https://investors.strive.com/overview/default.aspx"},
                    {"ticker": "NAKA","name": "Nakamoto Holdings","notes": "Nasdaq warning","tokens": 5765,"lastUpdate": "2025-11-19","change": 0,"cik": "0001946573","irUrl": "https://nakamoto.com/dashboard"},
                    {"ticker": "ABTC","name": "American Bitcoin","notes": "fka Gryphon Digital","tokens": 5427,"lastUpdate": "2026-01-05","change": 644,"cik": "0001755953","irUrl": "https://www.abtc.com/news"}
                ],
                "ETH": [
                    {"ticker": "BMNR","name": "BitMine Immersion","notes": "Largest ETH treasury. 3.48% of supply","tokens": 4203036,"lastUpdate": "2026-01-20","change": 35268,"cik": "0001829311","irUrl": "https://www.bitminetech.io/investor-relations","alertUrl": "https://www.sec.gov/Archives/edgar/data/1829311/000149315226002762/form8-k.htm","alertDate": "2026-01-20","alertNote": "8-K: 8-K"},
                    {"ticker": "SBET","name": "SharpLink Gaming","notes": "Has live ETH dashboard","tokens": 865797,"lastUpdate": "2026-01-20","change": 957,"cik": "0001811115","irUrl": "https://investors.sharplink.com/"},
                    {"ticker": "ETHM","name": "Ether Machine","tokens": 495362,"lastUpdate": "2025-09-02","change": 0,"cik": "0002028699","irUrl": "https://ethermachine.com/investors"},
                    {"ticker": "BTBT","name": "Bit Digital","notes": "Also holds WYFI stock","tokens": 155227,"lastUpdate": "2026-01-07","change": 0,"cik": "0001710350","irUrl": "https://bit-digital.com/investors/"},
                    {"ticker": "BTCS","name": "BTCS","notes": "Record $16M revenue 2025","tokens": 70500,"lastUpdate": "2026-01-07","change": 178,"cik": "0001521184","irUrl": "https://www.btcs.com/news-media/","alertUrl": "https://www.globenewswire.com/news-release/2026/01/07/3214520/0/en/BTCS-Record-Revenue.html","alertDate": "2026-01-07","alertNote": "2025 shareholder letter"},
                    {"ticker": "FGNX","name": "FG Nexus","tokens": 40088,"lastUpdate": "2025-12-17","change": 0,"cik": "0001591890","irUrl": "https://fgnexus.io/news/"},
                    {"ticker": "ETHZ","name": "Ethzilla","notes": "fka 180 Life Sciences","tokens": 8478,"lastUpdate": "2025-12-01","change": 0,"cik": "0001690080","irUrl": "https://www.ethzilla.com/investors"}
                ],
                "SOL": [
                    {"ticker": "FWDI","name": "Forward Industries","notes": "Largest SOL. Ticker was FORD","tokens": 6921342,"lastUpdate": "2025-12-02","change": 0,"cik": "0000038264","irUrl": "https://www.forwardindustries.com/media"},
                    {"ticker": "HSDT","name": "Solana Company","notes": "fka Helius Medical","tokens": 2300000,"lastUpdate": "2025-10-29","change": 0,"cik": "0001610853","irUrl": "https://www.solanacompany.co/"},
                    {"ticker": "DFDV","name": "DeFi Development","notes": "dfdvSOL liquid staking","tokens": 2221329,"lastUpdate": "2026-01-05","change": 25403,"cik": "0001805526","irUrl": "https://defidevcorp.com/investor","alertUrl": "https://www.globenewswire.com/news-release/2026/01/07/3214530/0/en/DeFi-Development-Year-Review.html","alertDate": "2026-01-08","alertNote": "2025 Year in Review"},
                    {"ticker": "UPXI","name": "Upexi","notes": "High-yield strategy 2026","tokens": 2174583,"lastUpdate": "2026-01-05","change": 67594,"cik": "0001839175","irUrl": "https://ir.upexi.com/","alertUrl": "https://www.globenewswire.com/news-release/2026/01/07/3214451/0/en/Upexi-High-Return-Strategy.html","alertDate": "2026-01-07","alertNote": "High-yield strategy"},
                    {"ticker": "STSS","name": "Sharps Technology","notes": "Coinbase validator partner","tokens": 2000000,"lastUpdate": "2026-01-12","change": 0,"cik": "0001737995","irUrl": "https://www.sharpstechnology.com/investors/news","alertUrl": "https://www.globenewswire.com/news-release/2026/01/12/3216808/0/en/Sharps-Coinbase-Validator.html","alertDate": "2026-01-12","alertNote": "Coinbase validator launch"}
                ],
                "HYPE": [
                    {"ticker": "PURR","name": "Hyperliquid Strategies","notes": "fka Sonnet Bio","tokens": 12600000,"lastUpdate": "2025-07-14","change": 0,"cik": "0001106838","irUrl": "https://www.sonnetbio.com/investors/news-events"},
                    {"ticker": "HYPD","name": "Hyperion DeFi","notes": "fka Eyenovia. Felix HIP-3","tokens": 1427178,"lastUpdate": "2026-01-12","change": 0,"cik": "0001682639","irUrl": "https://ir.hyperiondefi.com/","alertUrl": "https://www.globenewswire.com/news-release/2026/01/12/3216808/0/en/Hyperion-DeFi-Shareholder-Letter.html","alertDate": "2026-01-12","alertNote": "CEO shareholder letter"}
                ],
                "BNB": [
                    {"ticker": "BNC","name": "CEA Industries","tokens": 515054,"lastUpdate": "2025-12-01","change": 0,"cik": "0001482541","irUrl": "https://ceaindustries.com/investors.html"}
                ]
            }
        };

        let DATA = null;
        const TOKENS = ['BTC', 'ETH', 'SOL', 'HYPE', 'BNB'];
        const TOKEN_LABELS = { BTC: 'Bitcoin', ETH: 'Ethereum', SOL: 'Solana', HYPE: 'Hyperliquid', BNB: 'BNB' };
        let currentFilter = 'ALL';

        // Escape HTML to prevent XSS attacks
        const escapeHtml = (text) => {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        };

        const formatNum = n => n ? n.toLocaleString() : 'â€”';
        const formatCompact = n => {
            if (!n) return 'â€”';
            if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
            return n.toString();
        };
        const isRecent = (d, days = 14) => d && (Date.now() - new Date(d)) < days * 86400000;
        const getSecUrl = cik => cik ? `https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK=${cik}&type=8-K&dateb=&owner=include&count=40` : '';

        function getCompanies() {
            if (currentFilter === 'ALL') {
                return TOKENS.flatMap(token => 
                    (DATA.companies[token] || []).map(c => ({ ...c, token }))
                ).sort((a, b) => (b.tokens || 0) - (a.tokens || 0));
            }
            return (DATA.companies[currentFilter] || [])
                .map(c => ({ ...c, token: currentFilter }))
                .sort((a, b) => (b.tokens || 0) - (a.tokens || 0));
        }

        function renderStats() {
            document.getElementById('statsRow').innerHTML = TOKENS.map(token => {
                const list = DATA.companies[token] || [];
                const total = list.reduce((s, c) => s + (c.tokens || 0), 0);
                return `
                    <div class="stat-card ${token.toLowerCase()}">
                        <div class="stat-label">${TOKEN_LABELS[token]}</div>
                        <div class="stat-value mono">${formatCompact(total)}</div>
                        <div class="stat-meta">${list.length} ${list.length === 1 ? 'company' : 'companies'}</div>
                    </div>
                `;
            }).join('');
        }

        function renderTabs() {
            const tabs = ['ALL', ...TOKENS];
            document.getElementById('tabs').innerHTML = tabs.map(t => 
                `<button class="tab ${currentFilter === t ? 'active' : ''}" onclick="setFilter('${t}')">${t}</button>`
            ).join('');
        }

        function renderTable() {
            const companies = getCompanies();
            document.getElementById('companyCount').textContent = `${companies.length} companies`;

            document.getElementById('tableBody').innerHTML = companies.map(c => `
                <tr>
                    <td>
                        <div class="company-cell">
                            <span class="ticker-badge mono ${escapeHtml(c.token.toLowerCase())}">${escapeHtml(c.ticker)}</span>
                            <div class="company-info">
                                <div class="company-name">${escapeHtml(c.name)}</div>
                                ${c.notes ? `<div class="company-note" title="${escapeHtml(c.notes)}">${escapeHtml(c.notes)}</div>` : ''}
                            </div>
                        </div>
                    </td>
                    <td class="right">
                        <span class="holdings mono">${formatNum(c.tokens)}</span>
                        <span class="token-label">${escapeHtml(c.token)}</span>
                    </td>
                    <td class="right">
                        ${c.change > 0 ? `<span class="change-positive mono">+${formatNum(c.change)}</span>` :
                          c.change < 0 ? `<span class="change-negative mono">${formatNum(c.change)}</span>` :
                          '<span class="no-change">â€”</span>'}
                    </td>
                    <td class="center date-cell mono ${isRecent(c.lastUpdate, 7) ? 'fresh' : ''}">${escapeHtml(c.lastUpdate) || 'â€”'}</td>
                    <td class="center">
                        ${c.alertUrl && isRecent(c.alertDate) ?
                            `<a href="${escapeHtml(c.alertUrl)}" target="_blank" class="alert-badge" title="${escapeHtml(c.alertNote || '')}">ðŸ”” NEW</a>` :
                            '<span class="no-change">â€”</span>'}
                    </td>
                    <td class="center link-cell">
                        ${c.cik ? `<a href="${getSecUrl(escapeHtml(c.cik))}" target="_blank">8-K â†’</a>` : '<span class="na">N/A</span>'}
                    </td>
                    <td class="center link-cell">
                        <a href="${escapeHtml(c.irUrl)}" target="_blank">IR â†’</a>
                    </td>
                </tr>
            `).join('');
        }

        function setFilter(f) {
            currentFilter = f;
            renderTabs();
            renderTable();
        }

        function renderSectorPulse() {
            const pulseEl = document.getElementById('sectorPulse');
            if (!pulseEl) return;

            pulseEl.innerHTML = TOKENS.map(token => {
                const list = DATA.companies[token] || [];
                const totalChange = list.reduce((s, c) => s + (c.change || 0), 0);
                const totalHoldings = list.reduce((s, c) => s + (c.tokens || 0), 0);
                const recentChanges = list.filter(c => c.change !== 0 && isRecent(c.lastUpdate, 7));

                let activityText = 'No changes';
                let activityClass = '';
                if (totalChange > 0) {
                    activityText = `+${formatNum(totalChange)} this week`;
                    activityClass = 'has-change';
                } else if (recentChanges.length > 0) {
                    activityText = `${recentChanges.length} update${recentChanges.length > 1 ? 's' : ''} this week`;
                }

                return `
                    <div class="sector-card">
                        <div class="sector-card-header">
                            <span class="sector-token ${token.toLowerCase()}">${TOKEN_LABELS[token]}</span>
                            <span class="sector-count">${list.length} DATs</span>
                        </div>
                        <div class="sector-holdings mono" style="font-size: 18px; font-weight: 600; margin: 4px 0; color: var(--${token.toLowerCase()});">
                            ${formatCompact(totalHoldings)}
                        </div>
                        <div class="sector-activity ${activityClass}">${activityText}</div>
                    </div>
                `;
            }).join('');
        }

        function renderRecentActivity() {
            const activityEl = document.getElementById('recentActivity');
            if (!activityEl) return;

            // Get all companies with recent changes
            const recentChanges = [];
            TOKENS.forEach(token => {
                const list = DATA.companies[token] || [];
                list.forEach(company => {
                    if (company.change !== 0 && isRecent(company.lastUpdate, 14)) {
                        recentChanges.push({
                            ...company,
                            token: token
                        });
                    }
                });
            });

            // Sort by date (most recent first)
            recentChanges.sort((a, b) => new Date(b.lastUpdate) - new Date(a.lastUpdate));

            if (recentChanges.length === 0) {
                activityEl.innerHTML = `
                    <div class="activity-empty">
                        No token purchases in the last 14 days
                    </div>
                `;
                return;
            }

            activityEl.innerHTML = recentChanges.slice(0, 10).map(c => {
                const changeClass = c.change > 0 ? 'positive' : 'negative';
                const changePrefix = c.change > 0 ? '+' : '';
                const dateFormatted = formatRelativeDate(c.lastUpdate);

                return `
                    <div class="activity-item">
                        <span class="activity-ticker ${c.token.toLowerCase()}">${escapeHtml(c.ticker)}</span>
                        <div class="activity-info">
                            <div class="activity-name">${escapeHtml(c.name)}</div>
                            <div class="activity-date">${dateFormatted}</div>
                        </div>
                        <span class="activity-change ${changeClass}">
                            ${changePrefix}${formatNum(c.change)} ${c.token}
                        </span>
                    </div>
                `;
            }).join('');
        }

        function formatRelativeDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const now = new Date();
            const diffDays = Math.floor((now - date) / (24 * 60 * 60 * 1000));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 14) return 'Last week';
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function render() {
            // Use textContent for safe assignment (XSS protection)
            document.getElementById('lastUpdated').textContent = `Updated: ${DATA.lastUpdatedDisplay || 'Unknown'}`;

            // V2 Dashboard Components
            renderRecentActivity();
            renderSectorPulse();
            renderStats();
            renderTabs();
            renderTable();

            // Initialize Filing Feed if available
            if (typeof FilingFeed !== 'undefined') {
                FilingFeed.init('filingFeed', DATA);
            }

            // Initialize AI Summary service if available
            if (typeof AISummary !== 'undefined') {
                AISummary.init({
                    // API endpoint would be configured here
                    // apiEndpoint: 'https://api.anthropic.com/v1/messages',
                    // apiKey: 'your-api-key'
                });
            }
        }

        // Load data from data.json, fallback to embedded
        async function init() {
            try {
                const response = await fetch('./data.json?' + Date.now()); // Cache bust
                if (response.ok) {
                    DATA = await response.json();
                    console.log('Loaded data from data.json');
                } else {
                    throw new Error('Failed to fetch data.json');
                }
            } catch (e) {
                console.log('Using fallback data:', e.message);
                DATA = FALLBACK_DATA;
            }
            render();
        }

        init();
    </script>

    <!-- V2 Components -->
    <script src="js/services/ai-summary.js"></script>
    <script src="js/views/filing-feed.js"></script>
</body>
</html>
